ALTER SESSION SET NLS_DATE_FORMAT = 'DD/MM/YYYY';

SET LINESIZE 120
SET PAGESIZE 150

ACCEPT cust_id_starting PROMPT 'Please enter the starting Customer ID (C000001) or leave blank for all customers: '

ACCEPT cust_id_ending PROMPT 'Please enter the ending Customer ID (C000001) or leave blank for all customers: '

TTITLE CENTER 'Customer Booking Summary Report' RIGHT 'Page:' FORMAT 999 SQL.PNO SKIP 2

COLUMN CUST_ID FORMAT A15 HEADING 'Customer ID' 
COLUMN CUST_NAME FORMAT A18 HEADING 'Customer Name'
COLUMN BOOKING_ID FORMAT A15 HEADING 'Booking ID' 
COLUMN BOOKING_DATE FORMAT A15 HEADING 'Booking Date'
COLUMN TOTAL_AMOUNT FORMAT 9999990.99 HEADING 'Total Amount (RM)' 
COLUMN PASSENGER_ID FORMAT A15 HEADING 'Passenger ID' 

COMPUTE COUNT LABEL 'Total Bookings' of BOOKING_ID ON CUST_ID
COMPUTE SUM LABEL 'Customer Sales' of TOTAL_AMOUNT ON CUST_ID

BREAK ON CUST_ID SKIP 1 ON CUST_NAME

SELECT C.CUST_ID, C.CUST_NAME, P.PASSENGER_ID, B.BOOKING_ID, B.BOOKING_DATE, B.TOTAL_AMOUNT
FROM CUSTOMER C
JOIN BOOKING B ON C.CUST_ID = B.CUST_ID
JOIN PASSENGER P ON B.PASSENGER_ID = P.PASSENGER_ID  
WHERE C.CUST_ID BETWEEN NVL('&cust_id_starting', C.CUST_ID) AND NVL('&cust_id_ending', C.CUST_ID)
ORDER BY 1, 5 DESC;

CLEAR BREAK
CLEAR COLUMNS
CLEAR COMPUTES
TTITLE OFF
